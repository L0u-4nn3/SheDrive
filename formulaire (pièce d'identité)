/*HTML*/
<form class="form-upload">
  <div class="upload-container">
    <label for="id-upload" class="upload-label">
      <span>Pièce d'identité</span>
      <img src="camera-icon.png" alt="Icône caméra" class="camera-icon">
    </label>
    <input type="file" id="id-upload" class="upload-input" accept=".jpg, .png, .pdf">
    <p>Veuillez télécharger une photo de votre pièce d’identité (recto / verso)</p>
    <small>(Formats acceptés : JPG, PNG, PDF)</small>
  </div>

  <p class="info-text">
    La pièce d’identité sera définitivement supprimée de nos bases dès la vérification de votre inscription
  </p>

  <div class="terms-container">
    <input type="checkbox" id="terms" required>
    <label for="terms">J’accepte les <a href="/terms" target="_blank">conditions générales</a></label>
  </div>

  <button type="submit" class="btn-submit">Soumettre</button>
</form>

/*CSS*/
/* Style général */
.form-upload {
    font-family: Arial, sans-serif;
    color: #915858; /* Couleur de texte */
    text-align: center;
    max-width: 600px;
    margin: 0 auto;
  }
  
  .upload-container {
    border: 2px dashed #915858;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    position: relative;
  }
  
  .upload-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 1rem;
    font-weight: bold;
    color: #915858;
    cursor: pointer;
  }
  
  .upload-label .camera-icon {
    width: 24px;
    height: 24px;
  }
  
  .upload-input {
    display: none; /* Masque l'input de fichier */
  }
  
  .upload-container p {
    margin: 10px 0;
    font-size: 0.9rem;
  }
  
  .upload-container small {
    display: block;
    font-size: 0.8rem;
    color: #915858;
  }
  
  .info-text {
    color: #915858;
    font-size: 0.9rem;
    margin: 15px 0;
  }
  
  /* Checkbox et termes */
  .terms-container {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 15px 0;
  }
  
  .terms-container input {
    margin-right: 10px;
  }
  
  .terms-container label {
    font-size: 0.9rem;
    color: #915858;
  }
  
  .terms-container a {
    text-decoration: none;
    font-weight: bold;
    color: #915858;
  }
  
  .terms-container a:hover {
    text-decoration: underline;
  }
  
  /* Bouton */
  .btn-submit {
    background-color: #D8B1B6;
    color: white;
    border: none;
    border-radius: 25px;
    padding: 10px 20px;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  
  .btn-submit:hover {
    background-color: #C38989;
  }

  /*PHP*/
  
  ajouter dans fichier functions.php : 
  function render_custom_upload_form() {
    ob_start(); // Démarre la mise en mémoire tampon de sortie
    ?>
    <form class="form-upload" method="post" enctype="multipart/form-data">
        <div class="upload-container">
            <label for="id-upload" class="upload-label">
                <span>Pièce d'identité</span>
                <img src="<?php echo esc_url(get_template_directory_uri() . '/images/camera-icon.png'); ?>" alt="Icône caméra" class="camera-icon">
            </label>
            <input type="file" id="id-upload" class="upload-input" name="identity_file" accept=".jpg, .png, .pdf" required>
            <p>Veuillez télécharger une photo de votre pièce d’identité (recto / verso)</p>
            <small>(Formats acceptés : JPG, PNG, PDF)</small>
        </div>

        <p class="info-text">
            La pièce d’identité sera définitivement supprimée de nos bases dès la vérification de votre inscription
        </p>

        <div class="terms-container">
            <input type="checkbox" id="terms" name="accept_terms" required>
            <label for="terms">J’accepte les <a href="/conditions-generales" target="_blank">conditions générales</a></label>
        </div>

        <button type="submit" class="btn-submit">Soumettre</button>
    </form>

    <?php
    // Traitement du formulaire
    if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['identity_file'])) {
        if (!empty($_FILES['identity_file']['name'])) {
            $uploaded_file = $_FILES['identity_file'];
            $upload_overrides = array('test_form' => false);

            // Téléchargez le fichier dans le dossier "uploads" de WordPress
            $movefile = wp_handle_upload($uploaded_file, $upload_overrides);

            if ($movefile && !isset($movefile['error'])) {
                echo '<p class="success-message">Fichier téléchargé avec succès : ' . esc_url($movefile['url']) . '</p>';
            } else {
                echo '<p class="error-message">Erreur lors du téléchargement : ' . esc_html($movefile['error']) . '</p>';
            }
        } else {
            echo '<p class="error-message">Veuillez sélectionner un fichier.</p>';
        }
    }

    return ob_get_clean(); // Retourne le contenu généré
}
add_shortcode('custom_upload_form', 'render_custom_upload_form');
